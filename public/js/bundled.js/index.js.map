{"mappings":"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","sources":["<anon>","public/js/index.js","public/js/map.js","public/js/login.js","public/js/alert.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["require(\"@babel/polyfill\");\nvar $dzdWK$leaflet = require(\"leaflet\");\nvar $dzdWK$axios = require(\"axios\");\n\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\n\nconst $bc5a654fb3fe3dcf$var$mapContainer = document.getElementById(\"map\");\nif ($bc5a654fb3fe3dcf$var$mapContainer) {\n    var $bc5a654fb3fe3dcf$var$map = (0, ($parcel$interopDefault($dzdWK$leaflet))).map(\"map\").setView([\n        51.505,\n        -0.09\n    ], 13);\n    (0, ($parcel$interopDefault($dzdWK$leaflet))).tileLayer(\"https://tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n        maxZoom: 19,\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n    }).addTo($bc5a654fb3fe3dcf$var$map);\n}\nvar $bc5a654fb3fe3dcf$export$2e2bcd8739ae039 = $bc5a654fb3fe3dcf$var$map;\n\n\n\nconst $e9c91518574fdb31$export$516836c6a9dfc573 = ()=>{\n    const el = document.querySelector(\".alert\");\n    if (el) el.parentElement.removeChild(el);\n};\nconst $e9c91518574fdb31$export$de026b00723010c1 = (type, msg)=>{\n    $e9c91518574fdb31$export$516836c6a9dfc573();\n    const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\n    document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\n    window.setTimeout($e9c91518574fdb31$export$516836c6a9dfc573, 5000);\n};\n\n\nconst $bf5b431e6a69fea8$export$596d806903d1f59e = async (email, password)=>{\n    try {\n        const res = await (0, ($parcel$interopDefault($dzdWK$axios)))({\n            method: \"POST\",\n            url: \"/api/v1/users/login\",\n            data: {\n                email: email,\n                password: password\n            }\n        });\n        if (res.data.status === \"success\") {\n            (0, $e9c91518574fdb31$export$de026b00723010c1)(\"success\", \"Logged in successfully\");\n            window.setTimeout(()=>{\n                location.assign(\"/\");\n            }, 1500);\n        }\n    } catch (err) {\n        console.log(err.response);\n        (0, $e9c91518574fdb31$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\nconst $bf5b431e6a69fea8$export$a0973bcfe11b05c9 = async ()=>{\n    try {\n        const res = await (0, ($parcel$interopDefault($dzdWK$axios)))({\n            method: \"GET\",\n            url: \"/api/v1/users/logout\"\n        });\n        res.data.status = \"success\";\n        location.reload(true);\n        location.href = \"/\";\n    } catch (err) {\n        (0, $e9c91518574fdb31$export$de026b00723010c1)(\"error\", \"Error logging out! Try again\");\n    }\n};\n\n\n\n\nconst $955535ce7513e32c$export$f558026a994b6051 = async (data, type)=>{\n    // type is either 'passsword' or 'data'\n    try {\n        const url = type === \"password\" ? \"/api/v1/users/updateMyPassword\" : \"/api/v1/users/updateMe\";\n        const res = await (0, ($parcel$interopDefault($dzdWK$axios)))({\n            method: \"PATCH\",\n            url: url,\n            data: data\n        });\n        if (res.data.status === \"success\") {\n            (0, $e9c91518574fdb31$export$de026b00723010c1)(\"success\", `${type.toUpperCase()} update successfully`);\n            window.setTimeout(()=>{\n                location.assign(\"/me\");\n            }, 1500);\n        }\n    } catch (err) {\n        console.log(err.response);\n        (0, $e9c91518574fdb31$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\n\n\n\n\nconst $9fd71c92b6f885af$var$stripe = Stripe(\"pk_test_51OY3XhBa66NB5bPqkfz0Uzs9wIQMgMo3tFL9YuPWNs0guxmsCpN2ZTIWQHaEmS7oYkVQMikyT83vlgqig2mUInHO00i30TXuVj\");\nconst $9fd71c92b6f885af$export$8d5bdbf26681c0c2 = async (tourId)=>{\n    // 1) Get checkout session from API\n    try {\n        const session = await (0, ($parcel$interopDefault($dzdWK$axios)))(`/api/v1/bookings/checkout-session/${tourId}`);\n        // 2) Create checkout form + charge credit card\n        await $9fd71c92b6f885af$var$stripe.redirectToCheckout({\n            sessionId: session.data.session.id\n        });\n    } catch (err) {\n        console.log(err);\n        (0, $e9c91518574fdb31$export$de026b00723010c1)(\"error\", err);\n    }\n};\n\n\nconst $407eccdc61ba7a94$var$loginForm = document.querySelector(\".form--login\");\nconst $407eccdc61ba7a94$var$logOutBtn = document.querySelector(\".nav__el--logout\");\nconst $407eccdc61ba7a94$var$userDataForm = document.querySelector(\".form-user-data\");\nconst $407eccdc61ba7a94$var$userPasswordForm = document.querySelector(\".form-user-password\");\nconst $407eccdc61ba7a94$var$bookBtn = document.getElementById(\"book-tour\");\nif ($407eccdc61ba7a94$var$loginForm) $407eccdc61ba7a94$var$loginForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const email = document.getElementById(\"email\").value;\n    const password = document.getElementById(\"password\").value;\n    (0, $bf5b431e6a69fea8$export$596d806903d1f59e)(email, password);\n});\nif ($407eccdc61ba7a94$var$userDataForm) $407eccdc61ba7a94$var$userDataForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const form = new FormData();\n    form.append(\"name\", document.querySelector(\".form-user-data #name\").value);\n    form.append(\"email\", document.querySelector(\".form-user-data #email\").value);\n    form.append(\"photo\", document.querySelector(\".form-user-data #photo\").files[0]);\n    console.log(form);\n    (0, $955535ce7513e32c$export$f558026a994b6051)(form, \"data\");\n});\nif ($407eccdc61ba7a94$var$userPasswordForm) {\n    $407eccdc61ba7a94$var$userPasswordForm.addEventListener(\"submit\", (e)=>{\n        e.preventDefault();\n        document.querySelector(\".btn--save-password\").textContent = \"Updating...\";\n        const passwordCurrent = document.querySelector(\"#password-current\").value;\n        const password = document.querySelector(\"#password\").value;\n        const passwordConfirm = document.querySelector(\"#password-confirm\").value;\n        (0, $955535ce7513e32c$export$f558026a994b6051)({\n            passwordCurrent: passwordCurrent,\n            password: password,\n            passwordConfirm: passwordConfirm\n        }, \"password\");\n    });\n    document.querySelector(\".btn--save-password\").textContent = \"Save password\";\n    document.querySelector(\"#password-current\").value = \"\";\n    document.querySelector(\"#password\").value = \"\";\n    document.querySelector(\"#password-confirm\").value = \"\";\n}\nif ($407eccdc61ba7a94$var$logOutBtn) $407eccdc61ba7a94$var$logOutBtn.addEventListener(\"click\", (0, $bf5b431e6a69fea8$export$a0973bcfe11b05c9));\nif ($407eccdc61ba7a94$var$bookBtn) $407eccdc61ba7a94$var$bookBtn.addEventListener(\"click\", (e)=>{\n    e.target.textContent = \"Processing...\";\n    const { tourId: tourId } = e.target.dataset;\n    (0, $9fd71c92b6f885af$export$8d5bdbf26681c0c2)(tourId);\n});\n\n\n//# sourceMappingURL=index.js.map\n","import '@babel/polyfill';\r\nimport './map';\r\nimport { login, logout } from './login';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.querySelector('.form-user-data #name').value);\r\n    form.append(\r\n      'email',\r\n      document.querySelector('.form-user-data #email').value,\r\n    );\r\n    form.append(\r\n      'photo',\r\n      document.querySelector('.form-user-data #photo').files[0],\r\n    );\r\n\r\n    console.log(form);\r\n\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n\r\n    const passwordCurrent = document.querySelector('#password-current').value;\r\n    const password = document.querySelector('#password').value;\r\n    const passwordConfirm = document.querySelector('#password-confirm').value;\r\n    updateSettings({ passwordCurrent, password, passwordConfirm }, 'password');\r\n  });\r\n\r\n  document.querySelector('.btn--save-password').textContent = 'Save password';\r\n  document.querySelector('#password-current').value = '';\r\n  document.querySelector('#password').value = '';\r\n  document.querySelector('#password-confirm').value = '';\r\n}\r\n\r\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener('click', e => {\r\n    e.target.textContent = 'Processing...';\r\n    const { tourId } = e.target.dataset;\r\n    bookTour(tourId);\r\n  });\r\n}\r\n","import L from 'leaflet';\r\n\r\nconst mapContainer = document.getElementById('map');\r\nif (mapContainer) {\r\n  var map = L.map('map').setView([51.505, -0.09], 13);\r\n\r\n  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    maxZoom: 19,\r\n    attribution:\r\n      '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n  }).addTo(map);\r\n}\r\nexport default map;\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    console.log(err.response);\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n    if ((res.data.status = 'success')) location.reload(true);\r\n    location.href = '/';\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out! Try again');\r\n  }\r\n};\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// type is 'success' or 'error'\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\n\r\nexport const updateSettings = async (data, type) => {\r\n  // type is either 'passsword' or 'data'\r\n\r\n  try {\r\n    const url =\r\n      type === 'password'\r\n        ? '/api/v1/users/updateMyPassword'\r\n        : '/api/v1/users/updateMe';\r\n\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url,\r\n      data,\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type.toUpperCase()} update successfully`);\r\n      window.setTimeout(() => {\r\n        location.assign('/me');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    console.log(err.response);\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alert';\r\nconst stripe = Stripe(\r\n  'pk_test_51OY3XhBa66NB5bPqkfz0Uzs9wIQMgMo3tFL9YuPWNs0guxmsCpN2ZTIWQHaEmS7oYkVQMikyT83vlgqig2mUInHO00i30TXuVj',\r\n);\r\n\r\nexport const bookTour = async tourId => {\r\n  // 1) Get checkout session from API\r\n  try {\r\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\r\n    // 2) Create checkout form + charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n  } catch (err) {\r\n    console.log(err);\r\n    showAlert('error', err);\r\n  }\r\n};\r\n"],"names":["require","$dzdWK$leaflet","$dzdWK$axios","$parcel$interopDefault","a","__esModule","default","document","getElementById","$bc5a654fb3fe3dcf$var$map","map","setView","tileLayer","maxZoom","attribution","addTo","$e9c91518574fdb31$export$516836c6a9dfc573","el","querySelector","parentElement","removeChild","$e9c91518574fdb31$export$de026b00723010c1","type","msg","markup","insertAdjacentHTML","window","setTimeout","$bf5b431e6a69fea8$export$596d806903d1f59e","email","password","res","method","url","data","status","location","assign","err","console","log","response","message","$bf5b431e6a69fea8$export$a0973bcfe11b05c9","reload","href","$955535ce7513e32c$export$f558026a994b6051","toUpperCase","$9fd71c92b6f885af$var$stripe","Stripe","$9fd71c92b6f885af$export$8d5bdbf26681c0c2","tourId","session","redirectToCheckout","sessionId","id","$407eccdc61ba7a94$var$loginForm","$407eccdc61ba7a94$var$logOutBtn","$407eccdc61ba7a94$var$userDataForm","$407eccdc61ba7a94$var$userPasswordForm","$407eccdc61ba7a94$var$bookBtn","addEventListener","e","preventDefault","value","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target","dataset"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}